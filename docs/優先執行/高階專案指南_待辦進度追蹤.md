# 高階專案指南｜待辦進度追蹤表

## 專案概述
- **專案名稱**: Here4Help Flutter App
- **目前階段**: 待辦整備與部署準備（整合 @整合待辦項目.md 與 @todo_plan.json）
- **最新更新**: 2025-08-22（JWT 相容性測試、待辦與計畫文件建立）

---

## 📌 最近更新（已驗證）
- ✅ 建立並通過「PHP ↔ Node 相容性」的 JWT 簽名一致性檢驗（以 PHP 端生成 Token，簽名與手動計算一致）
  - 生成測試腳本：`backend/test/jwt_compatibility_test.php`（已執行通過）
  - 產生 Node 驗證腳本：`backend/test/jwt_node_test.js`（待 Socket 環境下實際執行）
- ✅ 整合待辦清單更新，新增「JWT 驗證問題」為最高優先級
- ✅ 建立部署與待辦計畫：
  - `docs/優先執行/部署高階專案指南.md`
  - `docs/優先執行/deployment_plan.json`
  - `docs/優先執行/待辦項目高階專案指南.md`
  - `docs/優先執行/todo_plan.json`

---

## 🎯 里程碑總覽（依優先級）

### M-CRITICAL-FIXES｜關鍵問題修復（1 週）
**目標**：修復影響系統運行的關鍵問題

- [ ] T1-JWT-SOCKET-SYNC：JWT 驗證修復（Socket 與 PHP 一致性）
  - 子任務：
    - [x] 以 PHP 端生成 Token 並驗證簽名一致性（相容性測試通過）
    - [x] 生成 Node 驗證腳本（`backend/test/jwt_node_test.js`）
    - [x] 在本機 Node 腳本驗證簽名與 payload（相同 JWT_SECRET）
    - [x] 校對 Socket 端 `.env` 與 PHP `JWT_SECRET` 一致性（SHA256 一致）
    - [x] 在實際 Socket 啟動環境驗證載入之 JWT_SECRET（伺服器啟動日誌已比對）
    - [ ] 確認 WebSocket 連線不再出現 `invalid signature`
  - 驗收：
    - PHP 生成的 JWT 可被 Node 正確驗證
    - WebSocket 連線不再出現 JWT 驗證錯誤
  - 參考檔案：`backend/utils/JWTManager.php`、`backend/socket/server.js`、`backend/test/jwt_compatibility_test.php`

- [x] T2-BACKEND-CONFIG-FIX：修復後端配置（database.php）
  - 步驟：基於 `database.example.php` 建立 `backend/config/database.php`；統一以 `__DIR__` 絕對路徑引用
  - 驗收：`backend/database/test_connection.php` 連線通過（已通過）

- [x] T3-PATH-STANDARDIZATION：PHP 路徑標準化
  - 步驟：以 `__DIR__` 為基準統一 `require_once`；跑 `php -l` 全專案語法檢查
  - 驗收：備份、測試、初始化腳本皆能正確載入

---

### M-FEATURE-ENHANCEMENT｜功能完善（1 週）
**目標**：完善用戶體驗與功能細節

- [ ] T4-ACCOUNT-SECURITY-COMPLETE：/account/security 完整化（客服聯繫、登出）
  - 驗收：按鈕可導向客服聊天室；登出流程完整
  - 檔案：`lib/account/pages/security_page.dart`、`lib/auth/services/auth_service.dart`、`lib/router/app_router.dart`

- [ ] T5-CHAT-SWIPE-OPTIMIZATION：聊天頁滑動工具列狀態邏輯優化
  - 驗收：動作與任務狀態正確對應，狀態轉換邏輯正確
  - 檔案：`lib/chat/widgets/posted_tasks_widget.dart`、`lib/chat/utils/action_bar_config.dart`

- [ ] T6-CHAT-DETAIL-ENHANCEMENT：/chat/detail 載入容錯與 Action Bar 同步
  - 驗收：聚合 API 失敗時有備援；Action Bar 與任務狀態同步；錯誤處理完善
  - 檔案：`lib/chat/pages/chat_detail_page.dart`、`lib/chat/widgets/dynamic_action_bar.dart`

---

### M-UX-OPTIMIZATION｜體驗優化（1 週）
**目標**：UI/UX 與資料一致性改善

- [ ] T7-TASK-RATINGS-FIX：`task_ratings` 結構適配
  - 驗收：評分系統顯示正常，API 與表結構一致
  - 檔案：`backend/api/tasks/ratings.php`

- [ ] T8-TABBAR-SYNC-FIX：聊天頁 TabBar 雙向同步
  - 驗收：TabBar 與 TabBarView 完整同步、切換流暢
  - 檔案：`lib/chat/pages/chat_list_page.dart`

- [ ] T9-UI-ENHANCEMENTS：頭像來源、未讀數、時間欄位預填
  - 驗收：卡片頭像顯示、未讀數準確、時間欄位正確預填
  - 檔案：`lib/widgets/applicant_card.dart`、`lib/chat/widgets/unread_badge.dart`、`lib/task/pages/task_edit_page.dart`

---

## 🚨 高優先級問題（整合自 @整合待辦項目.md）
1) JWT 驗證問題（WebSocket `invalid signature`）
2) 後端資料庫配置檔缺失（多檔引用 `backend/config/database.php`）
3) PHP 相對路徑導致載入失敗（統一絕對路徑）

---

## 🧪 測試與驗收（節選）
- JWT 相容性（已通過）
  - 指令：`php backend/test/jwt_compatibility_test.php`
  - 結果：簽名計算與 URL-Safe Base64 均一致（PHP 端）
  - 已執行：`node backend/test/jwt_node_test.js`（本機與 Socket 啟動環境皆比對一致）

- DB 連線（待辦）
  - 指令：`php backend/database/test_connection.php`
  - 驗收：成功回傳 DB 名稱與表清單（已通過）

- 聊天端點驗證（後續功能驗證項）：
  - `backend/api/chat/rooms.php`：目前本機直接 GET 回 500，推測為 JWT/參數缺失引起，非路徑錯誤；納入聊天功能驗證項處理。

---

## 📁 本階段關聯檔案
- 規劃與指南
  - `docs/優先執行/待辦項目高階專案指南.md`
  - `docs/優先執行/todo_plan.json`
  - `docs/優先執行/部署高階專案指南.md`
  - `docs/優先執行/deployment_plan.json`

- JWT 相容性測試
  - `backend/utils/JWTManager.php`
  - `backend/socket/server.js`
  - `backend/test/jwt_compatibility_test.php`
  - `backend/test/jwt_node_test.js`

---

## ▶ 建議執行順序（下一步）
1) 完成 T1-JWT-SOCKET-SYNC：校對 `.env` 與 Socket 驗證，清除 `invalid signature`
2) 補齊 `backend/config/database.php` 並統一引用路徑，完成 DB 連線測試
3) 完成 /account/security 的「客服聯繫、登出」
4) 依序進行聊天滑動工具列、/chat/detail 容錯、TabBar 同步與 UI 細節

### 備註（延後執行）
- cPanel 部署與測試（最後執行）：Socket/Web API/JWT/權限/.htaccess 全套驗證

---

## 進度標記（每日更新）
- 2025-08-22：
  - [x] 建立並通過 JWT 相容性測試（PHP 端）
  - [x] 產生 Node 測試腳本
  - [x] 建立部署與待辦計畫文件
  - [ ] Socket 環境實測與 `.env` 路徑確認
  - [ ] DB 連線測試通過


