# Here4Help 登入註冊功能部署檢查清單

> 本文件提供完整的部署檢查清單，確保第三方登入功能正常運作。

---

## 🚀 **部署前準備檢查**

### **1. 環境配置檢查**
- [ ] `.env.local` 檔案已建立並配置開發環境設定
- [ ] `.env.production` 檔案已建立並配置正式環境設定
- [ ] `env_loader.php` 已更新並可正常載入環境配置
- [ ] 資料庫連線設定正確

### **2. 第三方登入憑證檢查**
- [ ] **Google OAuth 2.0**：
  - [ ] Web 客戶端 ID 已配置
  - [ ] Android 客戶端 ID 已配置
  - [ ] iOS 客戶端 ID 已配置
  - [ ] 客戶端密鑰已配置
  - [ ] 回調 URL 已設定

- [ ] **Facebook OAuth 2.0**：
  - [ ] 應用程式 ID 已配置
  - [ ] 應用程式密鑰已配置
  - [ ] 客戶端權杖已配置
  - [ ] 回調 URL 已設定

- [ ] **Apple Sign-In**：
  - [ ] Team ID 已配置
  - [ ] Key ID 已配置
  - [ ] 服務 ID 已配置
  - [ ] Bundle ID 已配置
  - [ ] 私鑰已配置
  - [ ] 回調 URL 已設定

---

## 📁 **檔案部署檢查**

### **3. 後端檔案檢查**
- [ ] `backend/config/env_loader.php` 已更新
- [ ] `backend/config/env.local` 已建立
- [ ] `backend/config/env.production` 已建立
- [ ] `backend/api/auth/oauth-callback.php` 已建立
- [ ] `backend/api/auth/verify-email.php` 已建立
- [ ] `backend/api/auth/google/callback.php` 已建立
- [ ] `backend/api/auth/facebook/callback.php` 已建立
- [ ] `backend/api/auth/apple/callback.php` 已建立

### **4. Flutter 端檔案檢查**
- [ ] `lib/config/app_config.dart` 已更新
- [ ] `lib/auth/services/platform_auth_service.dart` 已更新

### **5. 資料庫遷移檢查**
- [ ] `user_identities` 表已建立
- [ ] `email_verification_tokens` 表已建立
- [ ] `users` 表結構已調整（允許 email/password 為 NULL）

---

## 🧪 **功能測試檢查清單**

### **6. 基礎功能測試**
- [ ] **密碼登入**：
  - [ ] 現有用戶可以正常登入
  - [ ] 新用戶可以正常註冊
  - [ ] JWT token 生成正常
  - [ ] 登入狀態保持正常

- [ ] **Email 驗證**：
  - [ ] 註冊後可以發送驗證信
  - [ ] 驗證連結可以正常點擊
  - [ ] 驗證成功後狀態更新正常

### **7. 第三方登入測試**
- [ ] **Google 登入**：
  - [ ] 新用戶 Google 登入可以建立帳號
  - [ ] 現有用戶 Google 登入可以正常登入
  - [ ] 用戶資料同步正常
  - [ ] 頭像顯示正常

- [ ] **Facebook 登入**：
  - [ ] 新用戶 Facebook 登入可以建立帳號
  - [ ] 現有用戶 Facebook 登入可以正常登入
  - [ ] 用戶資料同步正常
  - [ ] 頭像顯示正常

- [ ] **Apple 登入**：
  - [ ] 新用戶 Apple 登入可以建立帳號
  - [ ] 現有用戶 Apple 登入可以正常登入
  - [ ] 用戶資料同步正常
  - [ ] HTTPS 回調正常

### **8. 資料庫功能測試**
- [ ] **用戶資料**：
  - [ ] 第三方登入用戶資料正確儲存到 `user_identities` 表
  - [ ] 用戶主資料正確儲存到 `users` 表
  - [ ] 外鍵關聯正常

- [ ] **資料完整性**：
  - [ ] 唯一鍵約束正常（provider + provider_user_id）
  - [ ] 外鍵約束正常（user_id → users.id）
  - [ ] 級聯刪除正常

---

## 🔒 **安全性檢查**

### **9. 認證安全檢查**
- [ ] JWT token 簽名驗證正常
- [ ] Token 過期時間設定正確
- [ ] 第三方登入 token 驗證正常
- [ ] 敏感資訊未暴露在日誌中

### **10. 資料安全檢查**
- [ ] 用戶密碼已正確雜湊
- [ ] 第三方登入 token 安全儲存
- [ ] 資料庫連線使用 SSL（正式環境）
- [ ] 環境變數未暴露敏感資訊

---

## 🌐 **網路與部署檢查**

### **11. 網路配置檢查**
- [ ] **開發環境**：
  - [ ] `localhost:8888` 可以正常訪問
  - [ ] ngrok HTTPS 隧道正常運作
  - [ ] 回調 URL 可以正常訪問

- [ ] **正式環境**：
  - [ ] HTTPS 憑證正常
  - [ ] 網域解析正常
  - [ ] 防火牆設定正確

### **12. 第三方服務檢查**
- [ ] **Google**：
  - [ ] OAuth 同意畫面已配置
  - [ ] 授權的重新導向 URI 已設定
  - [ ] API 配額充足

- [ ] **Facebook**：
  - [ ] 應用程式狀態正常
  - [ ] 隱私政策已提供
  - [ ] 服務條款已提供

- [ ] **Apple**：
  - [ ] 開發者帳號狀態正常
  - [ ] 服務 ID 配置正確
  - [ ] 私鑰權限正確

---

## 📊 **效能與監控檢查**

### **13. 效能檢查**
- [ ] 登入響應時間 < 2 秒
- [ ] 資料庫查詢效能正常
- [ ] 第三方 API 響應時間正常
- [ ] 記憶體使用量正常

### **14. 監控與日誌檢查**
- [ ] 錯誤日誌正常記錄
- [ ] 登入嘗試日誌正常記錄
- [ ] 第三方登入日誌正常記錄
- [ ] 系統監控正常運作

---

## 🚨 **問題排除檢查**

### **15. 常見問題檢查**
- [ ] **CORS 錯誤**：已正確設定跨域請求
- [ ] **SSL 錯誤**：HTTPS 憑證正常
- [ ] **資料庫連線錯誤**：連線設定正確
- [ ] **第三方 API 錯誤**：憑證配置正確

### **16. 回滾準備檢查**
- [ ] 資料庫備份已完成
- [ ] 舊版程式碼已備份
- [ ] 回滾腳本已準備
- [ ] 回滾測試已完成

---

## ✅ **部署完成確認**

### **17. 最終確認**
- [ ] 所有功能測試通過
- [ ] 效能指標達標
- [ ] 安全性檢查通過
- [ ] 監控系統正常
- [ ] 用戶體驗滿意

### **18. 文檔更新**
- [ ] 部署記錄已更新
- [ ] 用戶手冊已更新
- [ ] 開發文檔已更新
- [ ] 變更記錄已更新

---

## 📞 **聯絡資訊**

如有問題或需要協助，請聯繫開發團隊。

**部署負責人**：_________________  
**部署日期**：_________________  
**部署版本**：_________________  
**部署狀態**：_________________
