# Action Bar Logic 逐步測試指南

## 🎯 測試目標
在現有的 Here4Help 專案中逐步測試 Action Bar Logic 的功能，確保所有實作都能正常工作。

## 📋 測試前準備

### 1. 確認環境狀態
```bash
# 確認 MAMP 正在運行
netstat -an | grep 8889

# 確認資料庫連接正常
php backend/test/test_fee_calculation.php
```

### 2. 確認費率設定
```bash
# 檢查當前費率設定
php backend/scripts/init_fee_settings_simple.php
```

## 🚀 逐步測試流程

### 步驟 1：啟動 Flutter 應用程式

```bash
# 啟動 Flutter Web 版本
flutter run -d chrome --web-port=8080

# 或啟動 iOS 模擬器
flutter run -d ios

# 或啟動 Android 模擬器
flutter run -d android
```

### 步驟 2：登入測試帳號

1. **打開應用程式**
2. **使用測試帳號登入**
   - 創建者帳號：用於測試確認完成功能
   - 接案者帳號：用於測試不同意功能

### 步驟 3：找到測試任務

1. **進入任務列表**
2. **尋找狀態為 `pending_confirmation` 的任務**
3. **點擊進入聊天詳情頁面**

### 步驟 4：測試 ConfirmCompletionDialog

#### 4.1 觸發 Dialog
1. **在聊天詳情頁面找到 Action Bar**
2. **點擊 "Confirm Completion" 按鈕**
3. **確認 Dialog 正確顯示**

#### 4.2 驗證 Dialog 內容
- [ ] 標題顯示 "Confirm Task Completion"
- [ ] 任務標題正確顯示
- [ ] 費率預覽資訊正確（2% 手續費）
- [ ] 按鈕狀態正確（Cancel, Retry, Confirm）

#### 4.3 測試費率預覽
1. **觀察預覽資訊**
   - 任務獎勵金額
   - 手續費率（2%）
   - 手續費金額
   - 淨額（獎勵 - 手續費）

#### 4.4 執行確認操作
1. **點擊 "Confirm" 按鈕**
2. **觀察載入狀態**
3. **確認成功訊息顯示**
4. **檢查任務狀態是否更新**

### 步驟 5：測試 DisagreeCompletionDialog

#### 5.1 觸發 Dialog
1. **在聊天詳情頁面找到 Action Bar**
2. **點擊 "Disagree" 按鈕**
3. **確認 Dialog 正確顯示**

#### 5.2 驗證 Dialog 內容
- [ ] 標題顯示 "Disagree with Completion"
- [ ] 任務標題正確顯示
- [ ] 理由輸入框存在
- [ ] 字數限制顯示（0/300）
- [ ] 按鈕狀態正確（Cancel, Submit）

#### 5.3 測試輸入驗證
1. **嘗試提交空理由**
   - 應該顯示錯誤訊息
2. **輸入超過 300 字的理由**
   - 應該被截斷或顯示錯誤
3. **輸入正常理由（50-100 字）**
   - 應該可以正常提交

#### 5.4 執行不同意操作
1. **輸入有效理由**
2. **點擊 "Submit" 按鈕**
3. **觀察載入狀態**
4. **確認成功訊息顯示**
5. **檢查任務狀態是否更新**

### 步驟 6：測試 AcceptApplication

#### 6.1 找到應徵任務
1. **進入任務列表**
2. **尋找狀態為 `open` 且有應徵者的任務**
3. **點擊進入聊天詳情頁面**

#### 6.2 測試接受應徵
1. **點擊 "Accept Application" 按鈕**
2. **確認成功訊息顯示**
3. **檢查任務狀態是否變為 `in_progress`**
4. **確認其他應徵者被拒絕**

## 🔍 測試檢查點

### Dialog 顯示檢查
- [ ] Dialog 正確彈出
- [ ] 背景變暗
- [ ] 內容居中顯示
- [ ] 按鈕功能正常

### API 調用檢查
- [ ] 網路請求正常發送
- [ ] 響應正確處理
- [ ] 錯誤訊息正確顯示
- [ ] 載入狀態正確

### 數據更新檢查
- [ ] 任務狀態正確更新
- [ ] 點數餘額正確變化
- [ ] 聊天記錄正確更新
- [ ] 系統訊息正確發送

### 用戶體驗檢查
- [ ] 操作流程順暢
- [ ] 錯誤處理友好
- [ ] 成功反饋清晰
- [ ] 載入狀態明確

## 🐛 常見問題與解決方案

### 問題 1：Dialog 不顯示
**可能原因**：
- Action Bar 配置錯誤
- 任務狀態不匹配
- 用戶權限不足

**解決方案**：
1. 檢查 `dynamic_action_bar.dart` 配置
2. 確認任務狀態為 `pending_confirmation`
3. 確認用戶為任務創建者

### 問題 2：API 調用失敗
**可能原因**：
- 網路連接問題
- API 端點錯誤
- 認證問題

**解決方案**：
1. 檢查網路連接
2. 確認 API 端點配置
3. 檢查 JWT token 有效性

### 問題 3：費率計算錯誤
**可能原因**：
- 資料庫費率設定錯誤
- 計算邏輯問題

**解決方案**：
1. 檢查費率設定：`php backend/test/test_fee_calculation.php`
2. 確認計算邏輯正確

### 問題 4：點數轉移失敗
**可能原因**：
- 用戶點數不足
- 資料庫交易失敗

**解決方案**：
1. 檢查用戶點數餘額
2. 查看資料庫錯誤日誌

## 📊 測試記錄表

### 測試記錄
| 測試項目 | 測試時間 | 測試結果 | 問題描述 | 解決狀態 |
|---------|---------|---------|---------|---------|
| ConfirmCompletionDialog | | | | |
| DisagreeCompletionDialog | | | | |
| AcceptApplication | | | | |
| 費率計算 | | | | |
| 點數轉移 | | | | |

### 問題追蹤
| 問題描述 | 嚴重程度 | 發現時間 | 解決時間 | 狀態 |
|---------|---------|---------|---------|------|
| | | | | |

## 🎯 測試完成標準

### 成功標準
- [ ] 所有 Dialog 正常顯示
- [ ] 所有 API 調用成功
- [ ] 所有數據正確更新
- [ ] 所有錯誤正確處理
- [ ] 用戶體驗良好

### 完成檢查清單
- [ ] ConfirmCompletionDialog 測試完成
- [ ] DisagreeCompletionDialog 測試完成
- [ ] AcceptApplication 測試完成
- [ ] 費率計算驗證完成
- [ ] 點數轉移驗證完成
- [ ] 錯誤處理驗證完成

## 🚀 下一步行動

1. **執行步驟 1-3**：啟動應用程式並登入
2. **執行步驟 4**：測試確認完成功能
3. **執行步驟 5**：測試不同意功能
4. **執行步驟 6**：測試接受應徵功能
5. **記錄測試結果**：填寫測試記錄表
6. **解決發現的問題**：根據問題追蹤表處理

---

**測試狀態**: 🟡 準備開始  
**預計時間**: 1-2 小時  
**測試方式**: 手動逐步測試
