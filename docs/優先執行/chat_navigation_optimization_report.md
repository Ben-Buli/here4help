# Chat Navigation å„ªåŒ–å ±å‘Š

## ğŸ” å•é¡Œåˆ†æ

### åŸå§‹å•é¡Œ
1. **æ•¸æ“šè¼‰å…¥æ™‚åºå•é¡Œ**ï¼šå¾ `/chat` åˆ° `/chat/detail` æ™‚ï¼ŒAppBar æ¨™é¡Œé¡¯ç¤ºéŒ¯èª¤
2. **å°èˆªé‚è¼¯ä¸ä¸€è‡´**ï¼šPosted Tasks å’Œ My Works ä½¿ç”¨ä¸åŒçš„å°èˆªæ–¹å¼
3. **ç¼ºå°‘è¼‰å…¥ç‹€æ…‹**ï¼šç”¨æˆ¶é»æ“Šå¾Œæ²’æœ‰è¦–è¦ºåé¥‹
4. **éŒ¯èª¤è™•ç†ä¸å®Œæ•´**ï¼šç¶²è·¯éŒ¯èª¤æ™‚ç”¨æˆ¶é«”é©—å·®

### æ ¹æœ¬åŸå› 
- **Posted Tasks**ï¼šç›´æ¥å°èˆªï¼Œæ²’æœ‰é è¼‰å…¥èŠå¤©å®¤æ•¸æ“š
- **My Works**ï¼šæœ‰é è¼‰å…¥ä½†é‚è¼¯è¤‡é›œï¼Œç¼ºå°‘çµ±ä¸€è™•ç†
- **ç¼ºå°‘çµ±ä¸€æœå‹™**ï¼šå…©å€‹åˆ†é ä½¿ç”¨ä¸åŒçš„å°èˆªé‚è¼¯

## ğŸ› ï¸ å¯¦æ–½çš„å„ªåŒ–

### 1. å‰µå»ºçµ±ä¸€å°èˆªæœå‹™ (`ChatNavigationService`)

**åŠŸèƒ½**ï¼š
- âœ… çµ±ä¸€çš„å°èˆªé‚è¼¯
- âœ… æ•¸æ“šé è¼‰å…¥æª¢æŸ¥
- âœ… è¼‰å…¥ç‹€æ…‹æŒ‡ç¤ºå™¨
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†
- âœ… æœ¬åœ°å„²å­˜ç®¡ç†

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```dart
// ç›´æ¥å°èˆªï¼ˆç”¨æ–¼ Posted Tasksï¼‰
ChatNavigationService.navigateToChatDetail(
  context: context,
  roomId: roomId,
)

// ç¢ºä¿èŠå¤©å®¤å­˜åœ¨ä¸¦å°èˆªï¼ˆç”¨æ–¼ My Worksï¼‰
ChatNavigationService.ensureRoomAndNavigate(
  context: context,
  taskId: taskId,
  creatorId: creatorId,
  participantId: participantId,
  existingRoomId: existingRoomId,
)
```

### 2. å‰µå»ºé è¼‰å…¥æœå‹™ (`ChatPreloadService`)

**åŠŸèƒ½**ï¼š
- âœ… èƒŒæ™¯é è¼‰å…¥èŠå¤©å®¤æ•¸æ“š
- âœ… æ‰¹é‡é è¼‰å…¥ï¼ˆé™åˆ¶ä¸¦ç™¼æ•¸ï¼‰
- âœ… è¨˜æ†¶é«”ç®¡ç†ï¼ˆä½¿ç”¨å¾Œæ¸…é™¤ï¼‰
- âœ… è¼‰å…¥ç‹€æ…‹è¿½è¹¤

**ä½¿ç”¨å ´æ™¯**ï¼š
```dart
// åœ¨ Posted Tasks è¼‰å…¥å®Œæˆå¾Œé è¼‰å…¥
_preloadChatData() {
  final roomIds = collectRoomIds();
  ChatPreloadService.preloadMultipleChatData(roomIds);
}
```

### 3. æ”¹é€² Posted Tasks å°èˆª

**å„ªåŒ–å‰**ï¼š
```dart
onTap: () {
  context.go('/chat/detail?room_id=$chatRoomId');
}
```

**å„ªåŒ–å¾Œ**ï¼š
```dart
onTap: () async {
  final success = await ChatNavigationService.navigateToChatDetail(
    context: context,
    roomId: chatRoomId,
  );
  
  if (!success) {
    showErrorSnackBar('ç„¡æ³•é€²å…¥èŠå¤©å®¤');
  }
}
```

### 4. ç°¡åŒ– My Works å°èˆª

**å„ªåŒ–å‰**ï¼š
- è¤‡é›œçš„ ensure_room é‚è¼¯
- æ‰‹å‹•çš„æ•¸æ“šè¼‰å…¥å’Œå„²å­˜
- é‡è¤‡çš„éŒ¯èª¤è™•ç†

**å„ªåŒ–å¾Œ**ï¼š
```dart
onTap: () async {
  final success = await ChatNavigationService.ensureRoomAndNavigate(
    context: context,
    taskId: taskId,
    creatorId: creatorId,
    participantId: participantId,
    existingRoomId: task['chat_room_id'],
  );
}
```

## ğŸ¯ å„ªåŒ–æ•ˆæœ

### 1. **ç”¨æˆ¶é«”é©—æ”¹å–„**
- âœ… çµ±ä¸€çš„è¼‰å…¥æŒ‡ç¤ºå™¨
- âœ… æ¸…æ™°çš„éŒ¯èª¤æç¤º
- âœ… æ›´å¿«çš„å°èˆªé€Ÿåº¦ï¼ˆé è¼‰å…¥ï¼‰

### 2. **ä»£ç¢¼å“è³ªæå‡**
- âœ… çµ±ä¸€çš„å°èˆªé‚è¼¯
- âœ… æ›´å¥½çš„éŒ¯èª¤è™•ç†
- âœ… æ¸›å°‘é‡è¤‡ä»£ç¢¼

### 3. **æ€§èƒ½å„ªåŒ–**
- âœ… èƒŒæ™¯é è¼‰å…¥æ¸›å°‘ç­‰å¾…æ™‚é–“
- âœ… è¨˜æ†¶é«”ç®¡ç†é¿å…æ´©æ¼
- âœ… ä¸¦ç™¼æ§åˆ¶é¿å…éè¼‰

### 4. **ç¶­è­·æ€§æå‡**
- âœ… é›†ä¸­åŒ–çš„å°èˆªé‚è¼¯
- âœ… çµ±ä¸€çš„éŒ¯èª¤è™•ç†
- âœ… æ›´å¥½çš„èª¿è©¦ä¿¡æ¯

## ğŸ“Š è¼‰å…¥æµç¨‹å°æ¯”

### å„ªåŒ–å‰æµç¨‹
```
ç”¨æˆ¶é»æ“Š â†’ ç›´æ¥å°èˆª â†’ èŠå¤©é é¢è¼‰å…¥æ•¸æ“š â†’ é¡¯ç¤ºå…§å®¹
```

### å„ªåŒ–å¾Œæµç¨‹
```
ç”¨æˆ¶é»æ“Š â†’ æª¢æŸ¥é è¼‰å…¥æ•¸æ“š â†’ é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨ â†’ è¼‰å…¥æ•¸æ“š â†’ ä¿å­˜åˆ°æœ¬åœ° â†’ å°èˆª â†’ ç«‹å³é¡¯ç¤ºå…§å®¹
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. **åœ¨ Posted Tasks ä¸­ä½¿ç”¨**
```dart
// åœ¨æ‡‰å¾µè€…å¡ç‰‡é»æ“Šæ™‚
onTap: () async {
  final success = await ChatNavigationService.navigateToChatDetail(
    context: context,
    roomId: applier['chat_room_id'],
  );
}
```

### 2. **åœ¨ My Works ä¸­ä½¿ç”¨**
```dart
// åœ¨ä»»å‹™å¡ç‰‡é»æ“Šæ™‚
onTap: () async {
  final success = await ChatNavigationService.ensureRoomAndNavigate(
    context: context,
    taskId: task['task_id'],
    creatorId: task['creator_id'],
    participantId: currentUserId,
    existingRoomId: task['chat_room_id'],
  );
}
```

### 3. **é è¼‰å…¥é…ç½®**
```dart
// åœ¨æ•¸æ“šè¼‰å…¥å®Œæˆå¾Œé è¼‰å…¥
void _preloadChatData() {
  final roomIds = collectRoomIds();
  ChatPreloadService.preloadMultipleChatData(roomIds);
}
```

## ğŸ”§ èª¿è©¦å’Œç›£æ§

### 1. **èª¿è©¦æ—¥èªŒ**
æ‰€æœ‰æœå‹™éƒ½æœ‰è©³ç´°çš„èª¿è©¦æ—¥èªŒï¼š
```
ğŸš€ [ChatNavigationService] é–‹å§‹å°èˆªåˆ°èŠå¤©è©³æƒ…
âœ… [ChatPreloadService] ä½¿ç”¨é è¼‰å…¥æ•¸æ“š: roomId
ğŸ“¡ [ChatNavigationService] é–‹å§‹è¼‰å…¥èŠå¤©å®¤æ•¸æ“š
```

### 2. **çµ±è¨ˆä¿¡æ¯**
```dart
// ç²å–é è¼‰å…¥çµ±è¨ˆ
final stats = ChatPreloadService.getStats();
print('é è¼‰å…¥æˆ¿é–“æ•¸: ${stats['preloadedCount']}');
print('æ­£åœ¨è¼‰å…¥: ${stats['loadingCount']}');
```

## ğŸ“ˆ é æœŸæ•ˆæœ

### 1. **è¼‰å…¥æ™‚é–“æ”¹å–„**
- **å„ªåŒ–å‰**ï¼šç”¨æˆ¶é»æ“Šå¾Œéœ€è¦ç­‰å¾…æ•¸æ“šè¼‰å…¥
- **å„ªåŒ–å¾Œ**ï¼šé è¼‰å…¥æ•¸æ“šå¯ç«‹å³ä½¿ç”¨ï¼Œè¼‰å…¥æ™‚é–“æ¸›å°‘ 50-80%

### 2. **éŒ¯èª¤ç‡é™ä½**
- **å„ªåŒ–å‰**ï¼šç¶²è·¯éŒ¯èª¤æ™‚ç›´æ¥å¤±æ•—
- **å„ªåŒ–å¾Œ**ï¼šæœ‰å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

### 3. **ç”¨æˆ¶é«”é©—æå‡**
- **å„ªåŒ–å‰**ï¼šé»æ“Šå¾Œç„¡åé¥‹ï¼Œå¯èƒ½å‡ºç¾ç©ºç™½é é¢
- **å„ªåŒ–å¾Œ**ï¼šæœ‰è¼‰å…¥æŒ‡ç¤ºå™¨ï¼ŒéŒ¯èª¤æ™‚æœ‰æ˜ç¢ºæç¤º

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè­°

### 1. **çŸ­æœŸå„ªåŒ–**
- [ ] æ·»åŠ ç¶²è·¯ç‹€æ…‹æª¢æ¸¬
- [ ] å¯¦ç¾é›¢ç·šæ¨¡å¼æ”¯æ´
- [ ] æ·»åŠ è¼‰å…¥é€²åº¦æ¢

### 2. **ä¸­æœŸå„ªåŒ–**
- [ ] å¯¦ç¾æ™ºèƒ½é è¼‰å…¥ï¼ˆåŸºæ–¼ç”¨æˆ¶è¡Œç‚ºï¼‰
- [ ] æ·»åŠ æ•¸æ“šå¿«å–ç­–ç•¥
- [ ] å¯¦ç¾èƒŒæ™¯åŒæ­¥

### 3. **é•·æœŸå„ªåŒ–**
- [ ] å¯¦ç¾è™›æ“¬åŒ–åˆ—è¡¨ï¼ˆå¤§é‡æ•¸æ“šï¼‰
- [ ] æ·»åŠ  A/B æ¸¬è©¦
- [ ] å¯¦ç¾æ€§èƒ½ç›£æ§

---

**å„ªåŒ–ç‹€æ…‹**: âœ… å·²å®Œæˆ  
**æ¸¬è©¦ç‹€æ…‹**: ğŸ”„ å¾…é©—è­‰  
**é æœŸæ•ˆæœ**: é¡¯è‘—æ”¹å–„ç”¨æˆ¶é«”é©—å’Œä»£ç¢¼å“è³ª
